ADMon and LDAP Mon

| ldapsearch domain=default search="(&(objectClass=computer))" attrs="distinguishedName, dNSHostName, managedBy, sAMAccountName" 
| rex max_match=5 field=distinguishedName "OU=(?<dn_parsed>[^,]+)" 
| eval nt_host=replace(sAMAccountName, "\$", ""), dns='dNSHostName', owner='managedBy', bunit_split=split(dn, ","), category=lower(replace(mvjoin(dn_parsed, "|"), " ", "_")), priority=case(match(category, "domain_controller|exchange|citrix"), "critical", match(category, "server|disabled"), "high", match(category, "workstation|desktop|mobile|laptop"), "medium", category IN ("staging", "test"), "low", 1==1, "unknown"), is_expected=if(priority IN ("critical", "high"), "true", "false") 
| rex field=bunit_split "(OU|CN)=(?<bunit>.+)" 
| table ip, mac, nt_host, dns, owner, priority, lat, long, city, country, bunit, category, pci_domain, is_expected, should_timesync, should_update, requires_av 
| outputlookup AD_Assets_LDAP




| TargetIP      | _time                        | host                                  | hosttype                 | region       | role    | uid                                                 |
| ------------- | ---------------------------- | ------------------------------------- | ------------------------ | ------------ | ------- | --------------------------------------------------- |
| 10.160.4.200  | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host13-mio  | inventory.example.device | us-example-1 | mio     | example.example.example.example-chassis7-host1-mio  |
| 10.0.5.23     | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host12-wic2 | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis6-host2-wic2 |
| 10.0.5.21     | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host12-wic1 | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis6-host2-wic1 |
| 10.160.4.207  | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host12-mio  | inventory.example.device | us-example-1 | mio     | example.example.example.example-chassis6-host2-mio  |
| 10.0.5.55     | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host11-wic2 | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis6-host1-wic2 |
| 10.0.5.53     | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host11-wic1 | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis6-host1-wic1 |
| 10.160.4.199  | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host11-mio  | inventory.example.device | us-example-1 | mio     | example.example.example.example-chassis6-host1-mio  |
| 10.0.5.19     | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host10-wic2 | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis5-host2-wic2 |
| 10.0.5.17     | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host10-wic1 | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis5-host2-wic1 |
| 10.160.4.206  | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host10-mio  | inventory.example.device | us-example-1 | mio     | example.example.example.example-chassis5-host2-mio  |
| 10.0.5.51     | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host9-wic2  | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis5-host1-wic2 |
| 10.0.5.49     | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host9-wic1  | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis5-host1-wic1 |
| 10.160.4.198  | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host9-mio   | inventory.example.device | us-example-1 | mio     | example.example.example.example-chassis5-host1-mio  |
| 10.0.5.15     | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host8-wic2  | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis4-host2-wic2 |
| 10.0.5.13     | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host8-wic1  | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis4-host2-wic1 |
| 10.160.4.205  | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host8-mio   | inventory.example.device | us-example-1 | mio     | example.example.example.example-chassis4-host2-mio  |
| 10.0.5.47     | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host7-wic2  | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis4-host1-wic2 |
| 10.0.5.45     | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host7-wic1  | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis4-host1-wic1 |
| 10.160.4.197  | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host7-mio   | inventory.example.device | us-example-1 | mio     | example.example.example.example-chassis4-host1-mio  |
| 10.0.5.11     | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host6-wic2  | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis3-host2-wic2 |
| 10.0.5.9      | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host6-wic1  | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis3-host2-wic1 |
| 10.160.4.204  | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host6-mio   | inventory.example.device | us-example-1 | mio     | example.example.example.example-chassis3-host2-mio  |
| 10.0.5.43     | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host5-wic2  | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis3-host1-wic2 |
| 10.0.5.41     | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host5-wic1  | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis3-host1-wic1 |
| 10.160.4.196  | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host5-mio   | inventory.example.device | us-example-1 | mio     | example.example.example.example-chassis3-host1-mio  |
| 10.0.5.7      | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host4-wic2  | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis2-host2-wic2 |
| 10.0.5.5      | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host4-wic1  | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis2-host2-wic1 |
| 10.160.4.203  | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host4-mio   | inventory.example.device | us-example-1 | mio     | example.example.example.example-chassis2-host2-mio  |
| 10.0.5.39     | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host3-wic2  | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis2-host1-wic2 |
| 10.0.5.37     | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host3-wic1  | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis2-host1-wic1 |
| 10.160.4.195  | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host3-mio   | inventory.example.device | us-example-1 | mio     | example.example.example.example-chassis2-host1-mio  |
| 10.0.5.3      | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host2-wic2  | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis1-host2-wic2 |
| 10.0.5.1      | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host2-wic1  | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis1-host2-wic1 |
| 10.160.4.202  | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host2-mio   | inventory.example.device | us-example-1 | mio     | example.example.example.example-chassis1-host2-mio  |
| 10.0.5.35     | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host1-wic2  | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis1-host1-wic2 |
| 10.0.5.33     | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host1-wic1  | inventory.example.device | us-example-1 | wic     | example.example.example.example-chassis1-host1-wic1 |
| 10.160.4.194  | 2020-10-06T20:12:42.000+0000 | regional.example.host-r25-host1-mio   | inventory.example.device | us-example-1 | mio     | example.example.example.example-chassis1-host1-mio  |
| 198.19.64.18  | 2020-10-06T20:12:42.000+0000 | regional.example.host-r24-u1          | inventory.example.device | us-example-1 | utility | example.example.example.example-rack20-utility1     |
| 198.18.128.87 | 2020-10-06T20:12:42.000+0000 | regional.example.host-r24             | inventory.example.device | us-example-1 | tor     | example.example.example.example-rack20-tor1         |

----------------------------------

| rest /services/data/indexes | where disabled = 0 | search NOT title = "_*" | eval currentDBSizeGB = round( currentDBSizeMB / 1024) | where currentDBSizeGB > 0 | table splunk_server title summaryHomePath_expanded minTime maxTime currentDBSizeGB totalEventCount frozenTimePeriodInSecs coldToFrozenDir maxTotalDataSizeMB | rename minTime AS earliest maxTime AS latest summaryHomePath_expanded AS index_path currentDBSizeGB AS index_size totalEventCount AS event_cnt frozenTimePeriodInSecs AS index_retention coldToFrozenDir AS index_path_frozen maxTotalDataSizeMB AS index_size_max title AS index

| Testing-test_server                                          | index                 | index_path                                                                                     | earliest                 | latest                   | index_size | event_cnt   | index_retention | index_path_frozen                                     | index_size_max |
| ------------------------------------------------------------ | --------------------- | ---------------------------------------------------------------------------------------------- | ------------------------ | ------------------------ | ---------- | ----------- | --------------- | ----------------------------------------------------- | -------------- |
| siem-Testing-test-indexer-01320.node.ad1.us-example-domain-1 | aaa                   | /opt/Testing-test/var/lib/Testing-test_example/exampledb/aaa/summary                           | 2020-08-07T03:08:07+0000 | 2021-09-13T21:00:41+0000 | 24         | 204610027   | 7776000         | /opt/Testing-test/var/lib/Testing-test_example/frozen | 1000000        |
| siem-Testing-test-indexer-01320.node.ad1.us-example-domain-1 | application_api       | /opt/Testing-test/var/lib/Testing-test_example/exampledb/application_api/summary               | 2021-07-07T21:54:57+0000 | 2021-09-13T21:00:49+0000 | 27         | 159524970   | 7776000         | /opt/Testing-test/var/lib/Testing-test_example/frozen | 100000         |
| siem-Testing-test-indexer-01320.node.ad1.us-example-domain-1 | application_debug     | /opt/Testing-test/var/lib/Testing-test_example/exampledb/application_debug/summary             | 2021-07-28T22:44:04+0000 | 2021-09-13T22:48:34+0000 | 97         | 828276223   | 7776000         | /opt/Testing-test/var/lib/Testing-test_example/frozen | 100000         |
| siem-Testing-test-indexer-01320.node.ad1.us-example-domain-1 | auditd                | /opt/Testing-test/var/lib/Testing-test_example/Testing-test_warm/auditd/summary                | 2019-10-18T09:04:00+0000 | 2021-09-13T21:01:52+0000 | 31         | 355852251   | 7776000         | /opt/Testing-test/var/lib/Testing-test_example/frozen | 25819000       |
| siem-Testing-test-indexer-01320.node.ad1.us-example-domain-1 | auditd_authentication | /opt/Testing-test/var/lib/Testing-test_example/Testing-test_warm/auditd_authentication/summary | 2021-06-15T22:52:48+0000 | 2021-09-13T21:01:58+0000 | 83         | 615578034   | 7776000         | /opt/Testing-test/var/lib/Testing-test_example/frozen | 25819000       |
| siem-Testing-test-indexer-01320.node.ad1.us-example-domain-1 | auditd_syscall        | /opt/Testing-test/var/lib/Testing-test_example/Testing-test_warm/auditd_syscall/summary        | 2021-06-25T23:58:51+0000 | 2021-09-13T21:01:57+0000 | 1358       | 11599612500 | 7776000         | /opt/Testing-test/var/lib/Testing-test_example/frozen | 25819000       |
| siem-Testing-test-indexer-01320.node.ad1.us-example-domain-1 | cavium                | /opt/Testing-test/var/lib/Testing-test_example/exampledb/cavium/summary                        | 2021-01-01T00:00:02+0000 | 2021-09-13T20:06:49+0000 | 10         | 162468270   | 7776000         | /opt/Testing-test/var/lib/Testing-test_example/frozen | 500000         |
| siem-Testing-test-indexer-01320.node.ad1.us-example-domain-1 | chef                  | /opt/Testing-test/var/lib/Testing-test_example/Testing-test_warm/chef/summary                  | 2021-06-17T21:50:43+0000 | 2021-09-13T21:01:35+0000 | 15         | 59015557    | 7776000         | /opt/Testing-test/var/lib/Testing-test_example/frozen | 100000         |
| siem-Testing-test-indexer-01320.node.ad1.us-example-domain-1 | databases             | /opt/Testing-test/var/lib/Testing-test_example/exampledb/databases/summary                     | 2021-05-11T22:12:13+0000 | 2021-09-11T18:58:24+0000 | 1          | 7147154     | 7776000         | /opt/Testing-test/var/lib/Testing-test_example/frozen | 100000         |
| siem-Testing-test-indexer-01320.node.ad1.us-example-domain-1 | fim                   | /opt/Testing-test/var/lib/Testing-test_example/Testing-test_warm/fim/summary                   | 2021-06-17T21:57:48+0000 | 2021-09-13T20:20:38+0000 | 1          | 6585225     | 7776000         | /opt/Testing-test/var/lib/Testing-test_example/frozen | 500000         |
| siem-Testing-test-indexer-01320.node.ad1.us-example-domain-1 | idp                   | /opt/Testing-test/var/lib/Testing-test_example/exampledb/idp/summary                           | 2020-08-03T20:57:06+0000 | 2021-09-13T20:59:18+0000 | 5          | 61982055    | 7776000         | /opt/Testing-test/var/lib/Testing-test_example/frozen | 100000         |
| siem-Testing-test-indexer-01320.node.ad1.us-example-domain-1 | ids                   | /opt/Testing-test/var/lib/Testing-test_example/Testing-test_warm/ids/summary                   | 2021-08-02T18:10:30+0000 | 2021-09-13T21:01:24+0000 | 73         | 345470038   | 7776000         | /opt/Testing-test/var/lib/Testing-test_example/frozen | 250000         |


------------------------------------


Identities look up 

| ldapsearch domain=default search="(&(samAccountType=805306368))" attrs="accountExpires, co, department, displayName, distinguishedName, givenName, l, mail, mobile, manager, memberOf, personalTitle, sAMAccountName, sn, st, telephoneNumber, userAccountControl, whenCreated" 
| rex field=memberOf "CN=(?<mof_parsed>[^,]+)" 
| rex max_match=5 field=distinguishedName "OU=(?<dn_parsed>[^,]+)" 
| eval memberOf=lower(replace(mvjoin(mof_parsed, "|"), " ", "_")), category=lower(replace(mvjoin(dn_parsed, "|"), " ", "_")), priority=case(match(category, "domain_admin|disabled|hold|executive") OR match(memberOf, "domain_admin|enterprise_admin|schema_admin|administrator"), "critical", match(category, "contractor|service_account|external"), "high", match(category, "employee|training|user_account|users|administration"), "medium", 1==1, "unknown"), startDate=strftime(strptime(whenCreated,"%Y%m%d%H%M"), "%m/%d/%Y %H:%M"), "%m/%d/%Y %H:%M"), endDate=strftime(strptime(accountExpires,"%Y-%m-%dT%H:%M:%S%Z"), "%m/%d/%Y %H:%M"), watchlist=if(category IN ("disabled", "hold"), "true", "false"), work_city=mvjoin(mvappend(l, st), ", ") 
| rename sAMAccountName as identity, personalTitle as prefix, displayName as nick, givenName as first, sn as last, mail as email, telephoneNumber as phone, mobile as phone2, manager as managedBy, department as bunit, co AS work_country 
| table identity, prefix, nick, first, last, suffix, email, phone, phone2, managedBy, priority, bunit, category, watchlist, startDate, endDate, work_city, work_country, work_lat, work_long 
| outputlookup ad_identities_lookup
